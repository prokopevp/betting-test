# betting-test

Общение между микросервисами обеспечивается с помощью `RabbitMQ`, БД у `bet-maker` - `Postgres`. Оба сохраняют состояние при перезагрузке.

- При создании события через `line-provider` отправляется сообщение брокеру, если не выходит (допустим, нет подключения к нему) - запрос выдает 500. 

- Соответственно `bet-maker` содержит слушателя (реализованный через `aio_pika.consumer`, прикрепленным к главному циклу событий), который при получении сообщения и после его валидации добавляет/обновляет запись о событии в БД (`postgres`).

- Так как в БД события связаны со ставками, то изменения статусов событий видны на поинте `/bets`.

**(!)** `bet-maker` **при запуске** пытается один раз обратиться к поинту `/events` у `line-provider` с целью инициализации событий в БД (если ответа нет - пропускает).  **Дальше уже идет подключение к `RabbitMQ` и общение продолжается только через него.**

**(!)** Как события выдаются только свежие (не просроченные), так и ставки можно ставить только на свежие события (иначе 404).

### Запуск
```
docker-compose up
```
### API 

**line-provider:** `:8000/docs` 

**bet-maker:** `:8080/docs`
